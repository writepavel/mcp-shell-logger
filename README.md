# MCP Shell Logger

MCP сервер для выполнения shell команд с гибкими настройками вывода и логирования.

## Описание

Этот MCP сервер предоставляет универсальный инструмент для выполнения shell команд с возможностью контроля над выводом и логированием. Особенно полезен для работы с командами, генерирующими большой объём вывода.

## Установка

```bash
npm install
```

## Использование

Сервер предоставляет два инструмента:

### 1. execute_command
Универсальная команда для выполнения shell команд с настраиваемым выводом и логированием.

**Параметры:**
- `command` (string) - команда для выполнения
- `workingDirectory` (string, optional) - рабочая директория для выполнения команды
- `maxOutput` (number, optional, default: 500) - максимальное количество символов для вывода:
  - `-1` - неограниченный вывод (используйте осторожно!)
  - `0` - без вывода (только статус выполнения)
  - `число > 0` - ограничить вывод указанным количеством символов
- `enableLogging` (boolean, optional, default: true) - сохранять ли команду и результат в лог файл

**Примеры использования:**

```bash
# Обычная команда с выводом по умолчанию (500 символов) и логированием
execute_command("ls -la")

# Команда с полным выводом без ограничений
execute_command("cat small_file.txt", "/home/user", -1)

# Docker build без вывода и без логирования
execute_command("docker build -t myapp .", "/project", 0, false)

# Установка пакетов с минимальным выводом, без логирования
execute_command("npm install", "/project", 100, false)

# Команда с перенаправлением вывода в файл (рекомендуется для больших выводов)
execute_command("find / -name '*.log' > /tmp/all_logs.txt 2>&1", "/", 0)
```

### 2. view_logs
Просматривает последние записи из лог файла.

**Параметры:**
- `lines` (number, default: 10) - количество последних записей для отображения

**Пример:**
```bash
view_logs(20)
```

## Рекомендации по использованию

### Работа с командами с большим выводом

Для команд, генерирующих большой объём данных (логи, листинги, сборки), рекомендуется:

1. **Перенаправлять вывод в файл:**
   ```bash
   # Сохранить вывод в файл
   execute_command("docker build -t myapp . > build.log 2>&1", "/project", 0)
   
   # Затем прочитать нужную часть
   execute_command("tail -n 50 build.log", "/project")
   ```

2. **Использовать фильтрацию:**
   ```bash
   # Вместо полного лога
   execute_command("npm install", "/project", 100)
   
   # Лучше отфильтровать важное
   execute_command("npm install 2>&1 | grep -E '(error|warning|installed)'", "/project")
   ```

3. **Использовать параметр maxOutput=0 для длительных операций:**
   ```bash
   # Только статус выполнения
   execute_command("./long_running_script.sh", "/scripts", 0)
   ```

## Логирование

Логи сохраняются в файл `~/.mcp-shell-commands.log` в формате JSON. Каждая запись содержит:
- timestamp - время выполнения
- command - выполненная команда
- exitCode - код завершения (0 = успех, 1 = ошибка)
- stdout - стандартный вывод
- stderr - вывод ошибок
- duration - время выполнения в миллисекундах

Логирование можно отключить для конкретной команды, установив `enableLogging: false`.

## Конфигурация в Claude Desktop

Добавьте в файл конфигурации Claude Desktop:

```json
{
  "mcpServers": {
    "shell-logger": {
      "command": "node",
      "args": ["/path/to/mcp-shell-logger/index.js"]
    }
  }
}
```

## Версии

- v2.0.0 - Упрощённый интерфейс с единой командой execute_command
- v1.1.0 - Добавлена команда execute_command_no_log
- v1.0.0 - Первоначальная версия
